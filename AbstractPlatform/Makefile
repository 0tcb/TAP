SMOKE?=0
ifeq ($(SMOKE),1)
	BOOGIESMOKE:=/smoke
else
	BOOGIESMOKE:=
endif

BOOGIEOPT:=/z3opt:smt.RELEVANCY=0 /z3opt:smt.CASE_SPLIT=0 /errorLimit:1 $(BOOGIESMOKE)

COMMON=../Common
BUILD=build
CPU_TARGET:=$(BUILD)/CPU.xml
INTEGRITY_PROOF_TARGET=$(BUILD)/IntegrityProof.xml
MEM_CONFIDENTIALITY_PROOF_TARGET=$(BUILD)/MemConfidentialityProof.xml
CACHE_CONFIDENTIALITY_PROOF_TARGET=$(BUILD)/CacheConfidentialityProof.xml
PT_CONFIDENTIALITY_PROOF_TARGET=$(BUILD)/PTConfidentialityProof.xml
COMMON_PROOF_TARGET:=$(BUILD)/ProofCommon.xml
MEASUREMENT_TARGET:=$(BUILD)/Measure.xml
MEASUREMENT_PROOF_TARGET=$(BUILD)/MeasurementProof.xml
TEMP_PROOF_TARGET:=$(BUILD)/temp.xml

COMMON_FILES:=$(COMMON)/Types.bpl $(COMMON)/Common.bpl $(COMMON)/Cache.bpl
ATP_COMMON_FILES:=Types.bpl $(COMMON_FILES)
CPU_FILES:=CPU.bpl
CPU_IMPL_FILES:=CPUImpl.bpl
COMMON_PROOF_FILES:=ProofCommon.bpl
COMMON_IMPL_FILES:=ImplCommon.bpl
INTEGRITY_PROOF_FILES:=IntegrityProof.bpl $(COMMON_PROOF_FILES)
CONFIDENTIALITY_COMMON_FILES:=ConfidentialityProof.bpl $(COMMON_PROOF_FILES)
MEM_CONFIDENTIALITY_PROOF_FILES:=MemConfidentialityProof.bpl
CACHE_CONFIDENTIALITY_PROOF_FILES:=CacheConfidentialityProof.bpl
PT_CONFIDENTIALITY_PROOF_FILES:=PTConfidentialityProof.bpl
MEASUREMENT_FILES:=Measure.bpl 
MEASUREMENT_PROOF_FILES:=MeasurementProof.bpl
TEMP_PROOF_FILES:=temp.bpl

all: $(CPU_TARGET) $(MEASUREMENT_TARGET) $(COMMON_PROOF_TARGET) $(INTEGRITY_PROOF_TARGET) $(MEM_CONFIDENTIALITY_PROOF_TARGET) $(CACHE_CONFIDENTIALITY_PROOF_TARGET) $(PT_CONFIDENTIALITY_PROOF_TARGET) $(MEASUREMENT_PROOF_TARGET)
$(CPU_TARGET): $(ATP_COMMON_FILES) $(CPU_FILES) $(CPU_IMPL_FILES)
	$(BOOGIE) $(BOOGIEOPT) /xml:$@ $^

$(INTEGRITY_PROOF_TARGET): $(ATP_COMMON_FILES) $(CPU_FILES) $(INTEGRITY_PROOF_FILES)
	$(BOOGIE) $(BOOGIEOPT) /xml:$@ $^

$(MEM_CONFIDENTIALITY_PROOF_TARGET): $(ATP_COMMON_FILES) $(CPU_FILES) $(CONFIDENTIALITY_COMMON_FILES) $(MEM_CONFIDENTIALITY_PROOF_FILES)
	$(BOOGIE) $(BOOGIEOPT) /xml:$@ $^

$(CACHE_CONFIDENTIALITY_PROOF_TARGET): $(ATP_COMMON_FILES) $(CPU_FILES) $(CONFIDENTIALITY_COMMON_FILES) $(CACHE_CONFIDENTIALITY_PROOF_FILES)
	$(BOOGIE) $(BOOGIEOPT) /xml:$@ $^

$(PT_CONFIDENTIALITY_PROOF_TARGET): $(ATP_COMMON_FILES) $(CPU_FILES) $(CONFIDENTIALITY_COMMON_FILES) $(PT_CONFIDENTIALITY_PROOF_FILES)
	$(BOOGIE) $(BOOGIEOPT) /xml:$@ $^

$(COMMON_PROOF_TARGET): $(COMMON_PROOF_FILES) $(CPU_FILES) $(ATP_COMMON_FILES) $(COMMON_IMPL_FILES)
	$(BOOGIE) $(BOOGIEOPT) /xml:$@ $^

$(MEASUREMENT_TARGET): $(MEASUREMENT_FILES) $(COMMON_PROOF_FILES) $(CPU_FILES) $(ATP_COMMON_FILES)
	$(BOOGIE) $(BOOGIEOPT) /xml:$@ $^

$(MEASUREMENT_PROOF_TARGET): $(MEASUREMENT_PROOF_FILES) $(MEASUREMENT_FILES) $(COMMON_PROOF_FILES) $(CPU_FILES) $(ATP_COMMON_FILES)
	$(BOOGIE) $(BOOGIEOPT) /xml:$@ $^

$(TEMP_PROOF_TARGET): $(TEMP_PROOF_FILES) $(COMMON_PROOF_FILES) $(CPU_FILES) $(ATP_COMMON_FILES)
	$(BOOGIE) $(BOOGIEOPT) /xml:$@ $^

clean:
	rm -f build/*.xml

.PHONY: clean
