BOOGIEOPT:=/z3opt:smt.RELEVANCY=0 /z3opt:smt.CASE_SPLIT=0 /errorLimit:1
MMU:=MMU
CPU:=CPU
HOST:=Host
COMMON:=../Common/
SANCTUM_COMMON:=Common
MONITOR:=Monitor
MEASUREMENT:=Measurement
UTILS:=Utils
BUILD=build

COMMON_FILES=$(COMMON)/Types.bpl $(COMMON)/Common.bpl
SANCTUM_COMMON_FILES=$(COMMON_FILES) \
										 $(SANCTUM_COMMON)/Machine.bpl \
										 $(SANCTUM_COMMON)/Prelude.bpl \
										 $(SANCTUM_COMMON)/Types.bpl
UTIL_FILES=$(UTILS)/Utils.bpl
MMU_FILES=$(MMU)/MMU.bpl $(MMU)/Common/Common.bpl
CPU_FILES=$(CPU)/CPU.bpl
ABSTRACT_RISCV_MMU=$(MMU_FILES) $(MMU)/AbstractSanctumMMU/AbstractRISCVMMU/AbstractRISCVMMU.bpl
ABSTRACT_SANCTUM_MMU=$(ABSTRACT_RISCV_MMU) $(MMU)/AbstractSanctumMMU/AbstractSanctumMMU.bpl
CONCRETE_RISCV_MMU=$(MMU_FILES) $(MMU)/ConcreteSanctumMMU/ConcreteRISCVMMU/ConcreteRISCVMMU.bpl
CONCRETE_SANCTUM_MMU=$(CONCRETE_RISCV_MMU) MMU/ConcreteSanctumMMU/ConcreteSanctumMMU.bpl

SANCTUM_PROOF_TARGET=$(BUILD)/SanctumProof.xml
MONITOR_PROOF_TARGET=$(BUILD)/MonitorProof.xml
MEASUREMENT_PROOF_TARGET=$(BUILD)/MeasurementProof.xml
ABSTRACT_RISCV_MMU_PROOF_TARGET=$(BUILD)/AbstractRISCVMMU.xml
ABSTRACT_SANCTUM_MMU_PROOF_TARGET=$(BUILD)/AbstractSanctumMMU.xml
CONCRETE_RISCV_MMU_PROOF_TARGET=$(BUILD)/ConcreteRISCVMMU.xml
CONCRETE_SANCTUM_MMU_PROOF_TARGET=$(BUILD)/ConcreteSanctumMMU.xml
MMU_IMPL_TARGET=$(BUILD)/MMUImpl.xml
MMU_PROOF_TARGET=$(BUILD)/MMUProof.xml
UTILS_PROOF_TARGET=$(BUILD)/UtilsProof.xml

all: $(MONITOR_PROOF_TARGET) \
	$(ABSTRACT_RISCV_MMU_PROOF_TARGET) $(ABSTRACT_SANCTUM_MMU_PROOF_TARGET) \
	$(CONCRETE_RISCV_MMU_PROOF_TARGET) $(CONCRETE_SANCTUM_MMU_PROOF_TARGET) \
	$(MMU_IMPL_TARGET) $(MMU_PROOF_TARGET) $(UTILS_PROOF_TARGET)

$(SANCTUM_PROOF_TARGET): $(SANCTUM_COMMON_FILES) $(UTIL_FILES) $(ABSTRACT_SANCTUM_MMU) $(CPU_FILES) $(MONITOR)/Monitor.bpl $(MONITOR)/MeasurementHelper.bpl Proof.bpl
	$(BOOGIE) /xml:$@ $(BOOGIEOPT) $^

$(MONITOR_PROOF_TARGET): $(SANCTUM_COMMON_FILES) $(UTIL_FILES) $(ABSTRACT_SANCTUM_MMU) $(CPU_FILES) $(MONITOR)/Monitor.bpl $(MONITOR)/MonitorImpl.bpl $(MONITOR)/MeasurementHelper.bpl $(MONITOR)/MeasurementHelperImpl.bpl
	$(BOOGIE) /xml:$@ $(BOOGIEOPT) $^

$(MEASUREMENT_PROOF_TARGET): $(SANCTUM_COMMON_FILES) $(UTIL_FILES) $(ABSTRACT_SANCTUM_MMU) $(CPU_FILES) $(MONITOR)/Monitor.bpl  $(MONITOR)/MeasurementHelper.bpl $(MEASUREMENT)/Measurement.bpl
	$(BOOGIE) /xml:$@ $(BOOGIEOPT) $^

$(ABSTRACT_RISCV_MMU_PROOF_TARGET): $(SANCTUM_COMMON_FILES) $(UTIL_FILES) $(ABSTRACT_RISCV_MMU) $(MMU)/AbstractSanctumMMU/AbstractRISCVMMU/AbstractRISCVMMUImpl.bpl
	$(BOOGIE) /xml:$@ $(BOOGIEOPT) $^

$(ABSTRACT_SANCTUM_MMU_PROOF_TARGET): $(SANCTUM_COMMON_FILES) $(UTIL_FILES) $(ABSTRACT_SANCTUM_MMU) $(MMU)/AbstractSanctumMMU/AbstractSanctumMMUImpl.bpl
	$(BOOGIE) /xml:$@ $(BOOGIEOPT) $^

$(CONCRETE_RISCV_MMU_PROOF_TARGET): $(SANCTUM_COMMON_FILES) $(UTIL_FILES) $(CONCRETE_RISCV_MMU) $(MMU)/ConcreteSanctumMMU/ConcreteRISCVMMU/ConcreteRISCVMMUImpl.bpl
	$(BOOGIE) /xml:$@ $(BOOGIEOPT) $^

$(CONCRETE_SANCTUM_MMU_PROOF_TARGET): $(SANCTUM_COMMON_FILES) $(UTIL_FILES) $(CONCRETE_SANCTUM_MMU) $(MMU)/ConcreteSanctumMMU/ConcreteSanctumMMUImpl.bpl
	$(BOOGIE) /xml:$@ $(BOOGIEOPT) $^

$(MMU_IMPL_TARGET): $(SANCTUM_COMMON_FILES) $(UTIL_FILES) $(ABSTRACT_SANCTUM_MMU) $(CONCRETE_SANCTUM_MMU) $(MMU)/MMUImpl.bpl 
	$(BOOGIE) /xml:$@ $(BOOGIEOPT) $^

$(MMU_PROOF_TARGET): $(SANCTUM_COMMON_FILES) $(UTIL_FILES) $(ABSTRACT_SANCTUM_MMU) $(CONCRETE_SANCTUM_MMU) $(MMU)/MMUProof.bpl
	$(BOOGIE) /xml:$@ $(BOOGIEOPT) $^

$(UTILS_PROOF_TARGET): $(SANCTUM_COMMON_FILES) $(UTIL_FILES) $(MMU_FILES) $(UTILS)/UtilsImpl.bpl
	$(BOOGIE) /xml:$@ $(BOOGIEOPT) $^

clean:
	rm -f $(BUILD)/*.xml

.PHONY: clean
